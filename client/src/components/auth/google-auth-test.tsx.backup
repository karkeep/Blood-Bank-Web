// client/src/components/auth/google-auth-test.tsx
import { useState } from "react";
import { signInWithPopup } from "firebase/auth";
import { auth, googleProvider } from "@/lib/firebase/firebase";
import { Button } from "@/components/ui/button";
import { useToast } from "@/hooks/use-toast";

export function GoogleAuthTest() {
  const [loading, setLoading] = useState(false);
  const { toast } = useToast();

  const testGoogleAuth = async () => {
    setLoading(true);
    console.log("ğŸ”¥ Testing Google Authentication...");
    
    try {
      console.log("ğŸ” Auth object:", auth);
      console.log("ğŸ” Provider object:", googleProvider);
      console.log("ğŸ” Auth current user:", auth.currentUser);
      
      const result = await signInWithPopup(auth, googleProvider);
      console.log("âœ… SUCCESS! Google auth result:", result);
      
      toast({
        title: "Google Auth Test Successful!",
        description: `Signed in as: ${result.user.displayName || result.user.email}`,
      });
      
    } catch (error: any) {
      console.error("âŒ Google auth test failed:", error);
      console.error("âŒ Error details:", {
        code: error.code,
        message: error.message,
        stack: error.stack
      });
      
      toast({
        title: "Google Auth Test Failed",
        description: `Error: ${error.message}`,
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="p-4 border rounded-lg bg-gray-50">
      <h3 className="font-bold mb-2">Google Auth Test</h3>
      <p className="text-sm text-gray-600 mb-4">
        This will test if Google authentication is working properly.
      </p>
      <Button 
        onClick={testGoogleAuth} 
        disabled={loading}
        className="w-full"
      >
        {loading ? "Testing..." : "Test Google Sign-In"}
      </Button>
    </div>
  );
}
